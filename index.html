<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <title>AstroTrapez</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Leaflet: najpierw lokalnie (je≈õli masz /libs/), potem CDN jako fallback -->
  <link rel="stylesheet" href="libs/leaflet.css" onerror="this.remove()">
  <script src="libs/leaflet.js" defer onerror="this.remove()"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>

  <!-- Wbudowane style (bez zale≈ºno≈õci) -->
  <style>
    :root{
      --bg:#060712;--panel:rgba(17,19,34,.72);--text:#e8ecff;--muted:#aab2d5;
      --accent:#7aa2ff;--accent2:#a07cff;--radius:16px;--shadow:0 12px 30px rgba(0,0,0,.45)
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;min-height:100%;
      background:radial-gradient(1200px 700px at 70% 30%, #2a2358 0%, transparent 60%), #060712;
      color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    a{color:var(--accent);text-decoration:none}a:hover{text-decoration:underline}
    .container{max-width:1200px;margin:0 auto;padding:24px}

    /* NAV z dropdownami */
    .nav{position:sticky;top:0;z-index:10;background:rgba(6,7,18,.6);backdrop-filter:blur(8px);
      border-bottom:1px solid rgba(255,255,255,.06)}
    .nav-inner{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:14px 24px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:36px;height:36px;border-radius:50%;
      background:radial-gradient(circle at 30% 30%,#b3c7ff,#6e44ff 60%,#1b1e3c 70%);
      box-shadow:0 0 30px #6e44ff80,inset 0 0 20px #b3c7ff40}
    .brand h1{font-size:18px;margin:0}
    .menu{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .drop{position:relative}
    .btn{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#0b0d1c;
      padding:10px 14px;border-radius:10px;font-weight:800;display:inline-flex;align-items:center;gap:8px}
    .caret{border:solid #0b0d1c;border-width:0 2px 2px 0;display:inline-block;padding:3px;transform:rotate(45deg)}
    .panel{position:absolute;top:110%;left:0;background:var(--panel);border:1px solid rgba(255,255,255,.08);
      border-radius:12px;box-shadow:var(--shadow);min-width:220px;padding:8px;display:none}
    .panel a{display:block;padding:10px 12px;color:var(--text);border-radius:8px}
    .panel a:hover{background:rgba(255,255,255,.08)}
    .drop.open .panel{display:block}

    /* Sekcja ISS na starcie (jak na /iss) */
    .section{background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:16px;
      box-shadow:var(--shadow);padding:18px}
    .grid{display:grid;gap:16px}
    .grid-2{grid-template-columns:1fr 1fr}
    @media(max-width:900px){.grid-2{grid-template-columns:1fr}}
    iframe{width:100%;height:420px;border:0;border-radius:12px;box-shadow:var(--shadow)}
    #map{width:100%;height:420px;border-radius:12px;overflow:hidden;box-shadow:var(--shadow)}

    /* Tiply */
    .tiply-fab{position:fixed;right:20px;bottom:20px;z-index:1000;display:flex;gap:10px;align-items:center;
      background:linear-gradient(135deg,#9e88ff,#6e44ff);padding:12px 14px;border-radius:999px;color:#0b0d1c;font-weight:800;
      box-shadow:0 10px 25px rgba(0,0,0,.45)}
  </style>

  <!-- Google font (opcjonalnie) -->
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body>
  <!-- NAV -->
  <nav class="nav">
    <div class="nav-inner container">
      <div class="brand"><div class="logo"></div><h1>AstroTrapez</h1></div>
      <div class="menu">
        <div class="drop">
          <a href="iss/" class="btn">üöÄ ISS <i class="caret"></i></a>
          <div class="panel">
            <a href="iss/">Live + Mapa</a>
          </div>
        </div>
        <div class="drop">
          <a href="wyrzuty/" class="btn">‚òÄÔ∏è Wyrzuty <i class="caret"></i></a>
          <div class="panel">
            <a href="wyrzuty/">Dane z NASA DONKI</a>
          </div>
        </div>
        <div class="drop">
          <a href="galeria/" class="btn">üõ∞Ô∏è Zdjƒôcia <i class="caret"></i></a>
          <div class="panel">
            <a href="galeria/">Galeria (Lightbox)</a>
          </div>
        </div>
        <a class="btn" href="live/">üé• Live</a>
      </div>
    </div>
  </nav>

  <!-- START: ta sekcja wy≈õwietla siƒô od razu po wej≈õciu -->
  <main class="container section" style="margin-top:18px">
    <h2>üöÄ ISS ‚Äì Live + Mapa</h2>
    <div class="grid grid-2" style="margin-top:10px">
      <div>
        <!-- Autoplay wymaga mute=1 -->
        <iframe src="https://www.youtube.com/embed/fO9e9jnhYK8?autoplay=1&mute=1"
                allow="autoplay; encrypted-media; picture-in-picture"
                allowfullscreen></iframe>
      </div>
      <div id="map"></div>
    </div>
  </main>
  <!-- KONIEC: sekcji startowej -->

  <a class="tiply-fab" href="https://tipply.pl/@trap3zik" target="_blank" rel="noopener">üíú Wesprzyj</a>

  <script>
    // Dropdowny (klik = otw√≥rz/zamknij; klik poza = zamknij)
    document.querySelectorAll('.drop > a.btn').forEach(btn=>{
      btn.addEventListener('click', e=>{
        // je≈ºeli to link do podstrony - nie blokujemy; panel i tak jest pomocniczy
        e.preventDefault();
        const d = btn.parentElement;
        const open = d.classList.contains('open');
        document.querySelectorAll('.drop').forEach(x=>x.classList.remove('open'));
        if(!open) d.classList.add('open');
      });
    });
    document.addEventListener('click', e=>{
      if(!e.target.closest('.drop')) document.querySelectorAll('.drop').forEach(x=>x.classList.remove('open'));
    });

    // Mapa ISS
    function initISS(){
      if(!window.L || !document.getElementById('map')) return;
      const map=L.map('map').setView([0,0],2);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; OpenStreetMap'}).addTo(map);
      const marker=L.marker([0,0]).addTo(map);
      async function updateISS(){
        try{
          const r=await fetch('https://api.wheretheiss.at/v1/satellites/25544');
          const d=await r.json();
          marker.setLatLng([d.latitude,d.longitude]);
          map.panTo([d.latitude,d.longitude],{animate:true});
        }catch(e){ console.warn('ISS fetch failed', e); }
      }
      updateISS(); setInterval(updateISS,5000);
    }
    // poczekaj a≈º Leaflet siƒô wczyta (z /libs lub z CDN)
    if (window.L) initISS(); else window.addEventListener('load', initISS);
  </script>
</body>
</html>
